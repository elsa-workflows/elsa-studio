        @page "/"
@using Elsa.Studio.Branding
@using Elsa.Studio.Shared.Components.Hosting
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@inject IConfiguration Configuration;
@inject IBrandingProvider BrandingProvider
@{
    var apiUrl = Configuration["Hosting:ApiUrl"];
    
    // Get the first segment of the request path, which represents the tenant ID.
    var segments = Request.Path.Value!.Split('/', StringSplitOptions.RemoveEmptyEntries);
    var tenantId = segments.Length is 1 or > 2 ? segments[0] : null;
    var baseRef = tenantId != null ? $"/{tenantId}/" : "/";
}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>Elsa Studio</title>
    <base href="@baseRef"/>
    <link rel="apple-touch-icon" sizes="180x180" href="@BrandingProvider.AppleTouchIconUrl">
    <link rel="icon" type="image/png" sizes="32x32" href="@BrandingProvider.Favicon32Url">
    <link rel="icon" type="image/png" sizes="16x16" href="@BrandingProvider.Favicon16Url">
    <link rel="manifest" href="_content/Elsa.Studio.Shell/site.webmanifest">
    <ElsaStudioHead IncludeDesignerCss="false" />
</head>

<body>

<ElsaStudioLoadingScreen Id="elsa-loading" />

<div id="app"></div>

<div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">🗙</a>
</div>

<ElsaStudioScripts Mode="BlazorHostingMode.WebAssembly" AutoStart="false" />

<script>
    window.getClientConfig = function() { return {
        "apiUrl": "@apiUrl"
     } };
</script>

<script src="_content/Elsa.Studio.Shared/js/elsa-studio-init.js"></script>

<script>
    // Initialize Blazor WASM with custom configuration when DOM is ready
    function initializeElsaBlazorWasm() {
        ElsaStudio.initializeBlazorWasm({
            loadBootResource: function (type, name, defaultUri, integrity) {
                if (defaultUri.startsWith('http'))
                    return defaultUri;

                if (!defaultUri.startsWith('/'))
                    return `/${defaultUri}`;

                return defaultUri;
            }
        });
    }

    document.addEventListener('DOMContentLoaded', function () {
        initializeElsaBlazorWasm();
    });

    // Safety timeout
    setTimeout(() => {
        ElsaStudio.hideLoading();
    }, 5000);
</script>

</body>

</html>