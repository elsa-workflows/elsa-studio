@page "/secrets/{SecretId}"
@using Elsa.Secrets
@using Variant = MudBlazor.Variant
@inherits StudioComponentBase
@using Elsa.Studio.Workflows.Services
@inject ElsaLocalization _localizer

<PageTitle>@_localizer["Secret"]</PageTitle>

<MudContainer MaxWidth="MaxWidth.False">
    <PageHeading Text="@($"Secret: {_model.Name}")"/>

    <MudCard>
        <MudForm Model="@_model"
                 @ref="@_form"
                 Validation="@((Func<SecretInputModel, bool>)(x => _validator.Validate(x).IsValid))"
                 ValidationDelay="0">

            <MudTabs Border="false" PanelClass="pa-6">
                <MudTabPanel Text="@_localizer["General"]">
                    <MudStack Spacing="8">
                        <MudTextField @bind-Value="_model.Name"
                                      For="@(() => _model.Name)"
                                      Immediate="true"
                                      Label="@_localizer["Name"]"
                                      Variant="Variant.Outlined"
                                      HelperText="@_localizer["The name of the secret."]"/>

                        <MudTextField @bind-Value="_model.Value"
                                      For="@(() => _model.Value)"
                                      Immediate="false"
                                      Label="@_localizer["Value"]"
                                      Variant="Variant.Outlined"
                                      HelperText="@_localizer["The secret value."]"/>

                        <MudSelect T="TimeSpan?" Label="@_localizer["Expires In"]" @bind-Value="_model.ExpiresIn" For="@(() => _model.ExpiresIn)" HelperText="@_localizer["The lifetime of this secret"]" Lines="4" Variant="Variant.Outlined">
                            <MudSelectItem T="TimeSpan?" Value="TimeSpan.FromDays(7)">@_localizer["7 days"]</MudSelectItem>
                            <MudSelectItem T="TimeSpan?" Value="TimeSpan.FromDays(14)">@_localizer["14 days"]</MudSelectItem>
                            <MudSelectItem T="TimeSpan?" Value="TimeSpan.FromDays(30)">@_localizer["30 days"]</MudSelectItem>
                            <MudSelectItem T="TimeSpan?" Value="TimeSpan.FromDays(90)">@_localizer["90 days"]</MudSelectItem>
                            <MudSelectItem T="TimeSpan?" Value="TimeSpan.FromDays(180)">@_localizer["180 days"]</MudSelectItem>
                            <MudSelectItem T="TimeSpan?" Value="@(null)">@_localizer["Never"]</MudSelectItem>
                        </MudSelect>

                        <MudSelect Label="@_localizer["Scope"]" 
                                   @bind-Value="_model.Scope" 
                                   For="@(() => _model.Scope)" 
                                   HelperText="@_localizer["The scope of the secret helps the UI to filter available options from dropdown lists."]" Lines="4" Variant="Variant.Outlined">
                            <MudSelectItem Value="@("General")">@_localizer["General"]</MudSelectItem>
                            <MudSelectItem Value="@("API Keys")">@_localizer["API Keys"]</MudSelectItem>
                            <MudSelectItem Value="@("Connection Strings")">@_localizer["Connection Strings"]</MudSelectItem>
                        </MudSelect>

                        <MudTextField @bind-Value="_model.Description"
                                      For="@(() => _model.Description)"
                                      Immediate="false"
                                      Label="@_localizer["Description"]"
                                      Variant="Variant.Outlined"
                                      HelperText="@_localizer["A description about the secret."]"/>
                    </MudStack>
                </MudTabPanel>
            </MudTabs>
        </MudForm>
        <MudCardActions>
            <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto" OnClick="@(async () => await OnSaveClicked())">@_localizer["Save"]</MudButton>
        </MudCardActions>
    </MudCard>
</MudContainer>