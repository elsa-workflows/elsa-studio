@using Elsa.Studio.Workflows.Components.WorkflowDefinitionEditor.Components.ActivityProperties
@using Elsa.Studio.Workflows.Services
@using Orientation = Radzen.Orientation
@using Variant = MudBlazor.Variant
@inherits WorkflowEditorComponentBase
@using Microsoft.Extensions.Localization
@inject ElsaLocalization _localizer

<RadzenSplitter Orientation="Orientation.Vertical" Style="height: calc(100vh - var(--mud-appbar-height));" Resize="@OnResize">
    <RadzenSplitterPane Size="70%">
        <DiagramDesignerWrapper 
            @ref="_diagramDesigner" 
            WorkflowDefinitionVersionId="@_workflowDefinition?.Id"
            Activity="@Activity"
            IsProgressing="@IsProgressing" 
            ActivitySelected="@OnActivitySelected" 
            GraphUpdated="@OnGraphUpdated">
            <CustomToolbarItems>
                <MudSwitch T="bool?" Value="@_autoSave" Color="Color.Primary" Label="@_localizer["Auto-save"]" LabelPosition="LabelPosition.Start" ValueChanged="@OnAutoSaveChanged" />
                <MudTooltip Text="@_localizer["Save"]" Delay="1000">
                    <MudBadge Color="@(_isDirty ? Color.Warning : Color.Success)" Dot="true" Overlap="true" Origin="Origin.BottomRight" Bordered="true" Class="elsa-toolbar-icon">
                        <MudIconButton Icon="@Icons.Material.Outlined.Save" title="@_localizer["Save"]" OnClick="@OnSaveClick" />
                    </MudBadge>
                </MudTooltip>

                <div id="workflow-file-upload-button-wrapper" class="d-none">
                    <MudFileUpload T="IReadOnlyList<IBrowserFile>" FilesChanged="@OnFilesSelected"/>
                </div>

                <MudTooltip Text="@_localizer["Publish the current workflow"]" Delay="1000">
                    <MudButtonGroup Color="Color.Default" Variant="Variant.Text" DropShadow="false">
                        <MudIconButton Icon="@Icons.Material.Filled.CloudUpload" Color="Color.Primary" title="@_localizer["Publish"]" OnClick="@OnPublishClicked"/>
                        <MudMenu Icon="@Icons.Material.Filled.ArrowDropDown">
                            @if (_workflowDefinition?.IsPublished == true)
                            {
                                <MudTooltip Text="@_localizer["Unpublish the current workflow"]" Inline="false" Delay="1000">
                                    <MudMenuItem Icon="@Icons.Material.Filled.CloudDownload" OnClick="@OnRetractClicked">@_localizer["Unpublish"]</MudMenuItem>
                                </MudTooltip>
                                <MudDivider DividerType="DividerType.FullWidth"></MudDivider>
                            }
                            <MudTooltip Text="@_localizer["Export the current workflow as a JSON file"]" Inline="false" Delay="1000">
                                <MudMenuItem Icon="@Icons.Material.Filled.FileDownload" OnClick="@OnExportClicked">@_localizer["Export"]</MudMenuItem>
                            </MudTooltip>
                            <MudTooltip Text="@_localizer["Import a JSON file containing workflow data to override the current workflow's contents."]" Inline="false" Delay="1000">
                                <MudMenuItem Icon="@Icons.Material.Filled.FileUpload" OnClick="@OnImportClicked">@_localizer["Import"]</MudMenuItem>
                            </MudTooltip>
                        </MudMenu>
                    </MudButtonGroup>
                </MudTooltip>
                <MudIconButton Icon="@Icons.Material.Filled.PlayArrow" Color="Color.Success" Variant="Variant.Text" title="@_localizer["Run workflow"]" Class="ml-4" OnClick="@OnRunWorkflowClicked"/>
            </CustomToolbarItems>
        </DiagramDesignerWrapper>
    </RadzenSplitterPane>
    <RadzenSplitterPane Size="30%" @ref="ActivityPropertiesPane">
        <ActivityPropertiesPanel @ref="ActivityPropertiesPanel" WorkflowDefinition="@_workflowDefinition" Activity="@SelectedActivity" ActivityDescriptor="@ActivityDescriptor" OnActivityUpdated="@OnSelectedActivityUpdated" VisiblePaneHeight="@_activityPropertiesPaneHeight"/>
    </RadzenSplitterPane>
</RadzenSplitter>